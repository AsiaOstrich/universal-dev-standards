# Cursor Rules
# Cursor 規則

This file defines the behavior for the Cursor AI editor to ensure compliance with Universal Doc Standards.
本檔案定義 Cursor AI 編輯器的行為，以確保符合通用文件規範。

## Usage | 使用方式

Copy this file to the root of your project as `.cursorrules`.
將此檔案複製到您專案的根目錄，並命名為 `.cursorrules`。

---

# Universal Doc Standards Compliance

You are an expert software engineer assistant. You are required to follow the **Universal Documentation Standards** defined in this project.

## Spec-Driven Development (SDD) Priority
## 規格驅動開發 (SDD) 優先

**Rule**: When an SDD tool (such as OpenSpec, Spec Kit, etc.) is integrated in this project and provides specific commands (e.g., slash commands like `/openspec` or `/spec`), you MUST prioritize using these commands over manual file editing.

**規則**：當專案整合了 SDD 工具（如 OpenSpec、Spec Kit 等）並提供特定命令（如 `/openspec` 或 `/spec` 斜線命令）時，你必須優先使用這些命令，而非手動編輯檔案。

**Detection**:
- OpenSpec: Check for `openspec/` directory or `openspec.json`
- Spec Kit: Check for `specs/` directory or `.speckit` configuration

**偵測方式**:
- OpenSpec: 檢查 `openspec/` 目錄或 `openspec.json`
- Spec Kit: 檢查 `specs/` 目錄或 `.speckit` 設定

**Rationale**:
- **Consistency**: Tools ensure spec structure follows strict schemas
- **Traceability**: Commands handle logging, IDs, and linking automatically
- **Safety**: Tools have built-in validation preventing invalid states

Reference: `.standards/spec-driven-development.md` (or `core/spec-driven-development.md`)

## Core Standards Usage Rule
## 核心標準使用規則

> **Core Standards Usage Rule**:
> When verifying standards, checking code, or performing tasks, **PRIORITIZE** reading the concise rules in `core/` (e.g., `core/testing-standards.md`).
> **ONLY** read `core/guides/` or `methodologies/guides/` when explicitly asked for educational content, detailed explanations, or tutorials.
> This ensures token efficiency and focused context.

**核心標準使用規則**：
> 當驗證標準、檢查程式碼或執行任務時，**優先**讀取 `core/` 中的精簡規則（例如 `core/testing-standards.md`）。
> 只有在被明確要求提供教育內容、詳細解釋或教學時，才讀取 `core/guides/` 或 `methodologies/guides/`。
> 這確保了 Token 效率和上下文聚焦。

## Core Protocol: Anti-Hallucination
Reference: `.standards/anti-hallucination.md` (or `core/anti-hallucination.md`)

1. **Evidence-Based Analysis**: 
   - You must read files before analyzing them.
   - Do not guess APIs, class names, or library versions.
   - If you haven't seen the code, state "I need to read [file] to confirm".

2. **Source Attribution**:
   - Every factual claim about the code must cite sources.
   - Format: `[Source: Code] path/to/file:line`
   - External docs: `[Source: External] http://url (Accessed: Date)`

3. **Certainty Classification**:
   - Use tags to indicate confidence: `[Confirmed]`, `[Inferred]`, `[Assumption]`, `[Unknown]`.

4. **Recommendations**:
   - When presenting options, YOU MUST explicitly state a "Recommended" choice with reasoning.

## Documentation & Commits

1. **Commit Messages**: 
   - Follow the pattern defined in `.standards/commit-message-guide.md`.
   - Default types: `feat`, `fix`, `docs`, `style`, `refactor`, `test`, `chore`.
   - Example: `feat(auth): add login support`

2. **Code Style**:
   - Follow language-specific style guides found in `.standards/` (e.g., `csharp-style.md`, `typescript-style.md`).

3. **Check-in Quality**:
   - Before suggesting "I'm done", verify against `.standards/checkin-standards.md`.

## Refactoring Standards
## 重構標準

Reference: `.standards/refactoring-standards.md` (or `core/refactoring-standards.md`)

When helping with refactoring:

1. **Decision Tree**:
   - Is code in production? No → Consider rewrite
   - Understood? No → Characterization tests first
   - Test coverage >60%? No → Add tests first
   - Architecture salvageable? No → Strangler Fig; Yes → Incremental refactoring

2. **Tactical Strategies** (daily, minutes):
   - **Boy Scout Rule**: Small cleanup as you go, don't change behavior
   - **Preparatory Refactoring**: Restructure before adding features ("First make the change easy, then make the easy change" - Kent Beck)
   - **Red-Green-Refactor**: TDD development cycle

3. **Strategic Strategies** (architectural, weeks-months):
   - **Strangler Fig**: Gradually replace legacy system (Intercept → Migrate → Complete)
   - **Anti-Corruption Layer (ACL)**: Translation layer to coexist with legacy without pollution
   - **Branch by Abstraction**: Refactor shared code on trunk with feature toggles

4. **Safety Strategies** (legacy code protection):
   - **Characterization Tests**: Capture existing behavior before changes
   - **Scratch Refactoring**: Refactor to understand, then discard
   - **Find Seams**: Identify injection points for test doubles
   - **Sprout/Wrap**: Add new logic in testable methods

**Quick Reference**:

| Situation | Recommended Strategy |
|-----------|---------------------|
| Feature blocked by messy code | Preparatory Refactoring |
| Bug fix touching existing code | Boy Scout Rule |
| Replacing entire legacy system | Strangler Fig |
| Integrating with messy legacy API | Anti-Corruption Layer |
| Working with untested code | Characterization Tests FIRST |
