# [AICONTEXT-01] Config Generation Specification

**Version**: 1.0.0
**Last Updated**: 2026-01-23
**Status**: Stable
**Spec ID**: AICONTEXT-01

---

## Summary

This specification defines the configuration generation logic for the `uds ai-context init` subcommand.

---

## Command Synopsis

```bash
uds ai-context init [options]

Options:
  --output <path>        Output file path (default: .ai-context.yaml)
  --depth <depth>        Directory scan depth (default: 3)
  --exclude <patterns>   Exclude patterns (comma-separated)
  -y, --yes              Non-interactive mode
  -h, --help             Display help
```

---

## Generation Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      AI-Context Generation Flow                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   1. Scan project structure                                                  │
│      └── Walk directories up to specified depth                             │
│                                                                              │
│   2. Identify modules                                                        │
│      ├── Detect package boundaries (package.json, __init__.py)              │
│      ├── Detect common patterns (src/, lib/, utils/)                        │
│      └── Group by directory structure                                        │
│                                                                              │
│   3. Analyze dependencies                                                    │
│      ├── Parse import/require statements                                     │
│      ├── Analyze package dependencies                                        │
│      └── Build dependency graph                                              │
│                                                                              │
│   4. Generate YAML                                                           │
│      ├── Create module definitions                                           │
│      ├── Add boundary suggestions                                            │
│      └── Include dependency information                                      │
│                                                                              │
│   5. Write file                                                              │
│      └── .ai-context.yaml                                                    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## Module Detection

### Directory-Based Detection

```javascript
const MODULE_PATTERNS = [
  'src/*/',           // src/commands/, src/utils/
  'lib/*/',           // lib/core/
  'packages/*/',      // Monorepo packages
  'apps/*/',          // Monorepo apps
  'modules/*/'        // modules/auth/
];

function detectModules(projectPath, depth) {
  const modules = [];

  for (const pattern of MODULE_PATTERNS) {
    const matches = glob.sync(pattern, { cwd: projectPath });
    for (const match of matches) {
      modules.push({
        name: path.basename(match),
        path: match,
        type: 'directory'
      });
    }
  }

  return modules;
}
```

### File-Based Detection

```javascript
const PACKAGE_INDICATORS = {
  javascript: ['package.json', 'index.js', 'index.ts'],
  python: ['__init__.py', 'setup.py', 'pyproject.toml'],
  go: ['go.mod'],
  rust: ['Cargo.toml']
};
```

---

## Dependency Analysis

### JavaScript/TypeScript

```javascript
function analyzeJSDependencies(filePath) {
  const content = fs.readFileSync(filePath, 'utf-8');
  const dependencies = [];

  // ES Module imports
  const importMatches = content.matchAll(/import .* from ['"](.+)['"]/g);
  for (const match of importMatches) {
    dependencies.push(match[1]);
  }

  // CommonJS requires
  const requireMatches = content.matchAll(/require\(['"](.+)['"]\)/g);
  for (const match of requireMatches) {
    dependencies.push(match[1]);
  }

  return dependencies;
}
```

### Python

```javascript
function analyzePyDependencies(filePath) {
  const content = fs.readFileSync(filePath, 'utf-8');
  const dependencies = [];

  // Import statements
  const importMatches = content.matchAll(/^(?:from|import) (\S+)/gm);
  for (const match of importMatches) {
    dependencies.push(match[1].split('.')[0]);
  }

  return dependencies;
}
```

---

## Output Format

```yaml
# Generated by UDS ai-context init
# Customize this file to define your project's AI-friendly architecture

version: "1.0"

project:
  name: "universal-dev-standards"
  description: "Language-agnostic development standards framework"
  repository: "https://github.com/AsiaOstrich/universal-dev-standards"

modules:
  - name: "cli-commands"
    path: "cli/src/commands/"
    description: "CLI command implementations"
    boundary: "internal"
    exports:
      - init.js
      - check.js
      - update.js
      - configure.js
      - list.js
      - skills.js
      - agent.js
      - workflow.js
      - ai-context.js
    dependencies:
      - "cli-utils"
      - "cli-prompts"
      - "cli-config"

  - name: "cli-utils"
    path: "cli/src/utils/"
    description: "Shared utility functions"
    boundary: "internal"
    exports:
      - copier.js
      - hasher.js
      - integration-generator.js
      - skills-installer.js
    dependencies:
      - "cli-config"

  - name: "cli-prompts"
    path: "cli/src/prompts/"
    description: "Interactive prompt definitions"
    boundary: "internal"
    exports:
      - init.js
      - integrations.js
    dependencies: []

  - name: "cli-config"
    path: "cli/src/config/"
    description: "Configuration constants"
    boundary: "internal"
    exports:
      - ai-agent-paths.js
    dependencies: []

boundaries:
  internal:
    description: "Internal implementation modules"
    access: "private"

  public:
    description: "Public API modules"
    access: "public"
```

---

## Acceptance Criteria

- [ ] Scans project structure correctly
- [ ] Detects modules from common patterns
- [ ] Analyzes JS/TS/Python dependencies
- [ ] Generates valid YAML output
- [ ] Handles nested directory structures
- [ ] Excludes common non-source directories (node_modules, .git)

---

## Related Specifications

- [AICONTEXT-00 AI-Context Overview](00-ai-context-overview.md)
