# Integrated Flow - ATDD â†’ SDD â†’ BDD â†’ TDD Methodology
# Version: 1.0.0
# Complete development workflow combining all test-driven methodologies

$schema: "./methodology-schema.json"
id: integrated-flow
name: Integrated Development Flow
nameZh: æ•´åˆé–‹ç™¼æµç¨‹
version: 1.0.0
description: Complete development workflow combining ATDD, SDD, BDD, and TDD for maximum quality and traceability.
descriptionZh: çµåˆ ATDDã€SDDã€BDD å’Œ TDD çš„å®Œæ•´é–‹ç™¼å·¥ä½œæµç¨‹ï¼Œå¯¦ç¾æœ€é«˜å“è³ªå’Œå¯è¿½æº¯æ€§ã€‚
status: experimental
statusNote: "This methodology system will be redesigned in v4.0"
statusNoteZh: "æ­¤æ–¹æ³•è«–ç³»çµ±å°‡åœ¨ v4.0 ä¸­é‡æ–°è¨­è¨ˆ"

phases:
  # ATDD Phases
  - id: specification-workshop
    name: Specification Workshop (ATDD)
    nameZh: è¦æ ¼å·¥ä½œåŠ (ATDD)
    description: Collaboratively define acceptance criteria with stakeholders
    descriptionZh: èˆ‡åˆ©å®³é—œä¿‚äººå”ä½œå®šç¾©é©—æ”¶æ¢ä»¶
    duration: "30-60 minutes"
    emoji: "\U0001F91D"
    methodology: atdd
    checklist:
      - id: po-presents
        text: Product Owner presents user story
        textZh: ç”¢å“è² è²¬äººå±•ç¤ºä½¿ç”¨è€…æ•…äº‹
        required: true
      - id: team-questions
        text: Team asks clarifying questions
        textZh: åœ˜éšŠæå‡ºæ¾„æ¸…å•é¡Œ
        required: true
      - id: ac-defined
        text: Acceptance criteria defined in Given-When-Then format
        textZh: ä»¥ Given-When-Then æ ¼å¼å®šç¾©é©—æ”¶æ¢ä»¶
        required: true
      - id: out-of-scope
        text: Out of scope items documented
        textZh: ç¯„åœå¤–äº‹é …å·²è¨˜éŒ„
        required: true
    triggers:
      entry:
        - condition: new_feature_request
        - condition: user_invokes_integrated_flow
      exit:
        - condition: acceptance_criteria_defined
          nextPhase: spec-proposal
    guidance:
      prompt: |
        ## ğŸ¤ Phase 1: Specification Workshop (ATDD)

        **Goal**: Define WHAT we're building with stakeholders.

        ### User Story Template
        ```markdown
        ## User Story: [Title]

        **As a** [role]
        **I want** [feature]
        **So that** [benefit]

        ## Acceptance Criteria

        ### AC-1: [Happy path]
        **Given** [precondition]
        **When** [action]
        **Then** [expected result]

        ## Out of Scope
        - [Explicitly excluded items]
        ```

        ### Workshop Questions
        1. What is the happy path?
        2. What could go wrong?
        3. What are the boundary conditions?

        Let's start defining the acceptance criteria.
      promptZh: |
        ## ğŸ¤ éšæ®µ 1ï¼šè¦æ ¼å·¥ä½œåŠ (ATDD)

        **ç›®æ¨™**ï¼šèˆ‡åˆ©å®³é—œä¿‚äººå®šç¾©æˆ‘å€‘è¦å»ºç«‹ä»€éº¼ã€‚

        ### ä½¿ç”¨è€…æ•…äº‹æ¨¡æ¿
        ```markdown
        ## ä½¿ç”¨è€…æ•…äº‹ï¼š[æ¨™é¡Œ]

        **ä½œç‚º** [è§’è‰²]
        **æˆ‘æƒ³è¦** [åŠŸèƒ½]
        **ä»¥ä¾¿** [å¥½è™•]

        ## é©—æ”¶æ¢ä»¶

        ### AC-1: [å¿«æ¨‚è·¯å¾‘]
        **Given** [å‰ç½®æ¢ä»¶]
        **When** [å‹•ä½œ]
        **Then** [é æœŸçµæœ]

        ## ç¯„åœå¤–
        - [æ˜ç¢ºæ’é™¤çš„äº‹é …]
        ```

        ### å·¥ä½œåŠå•é¡Œ
        1. å¿«æ¨‚è·¯å¾‘æ˜¯ä»€éº¼ï¼Ÿ
        2. ä»€éº¼å¯èƒ½å‡ºéŒ¯ï¼Ÿ
        3. é‚Šç•Œæ¢ä»¶æ˜¯ä»€éº¼ï¼Ÿ

        è®“æˆ‘å€‘é–‹å§‹å®šç¾©é©—æ”¶æ¢ä»¶ã€‚
    reminders: []

  # SDD Phases
  - id: spec-proposal
    name: Spec Proposal (SDD)
    nameZh: è¦æ ¼ææ¡ˆ (SDD)
    description: Write technical specification based on acceptance criteria
    descriptionZh: æ ¹æ“šé©—æ”¶æ¢ä»¶æ’°å¯«æŠ€è¡“è¦æ ¼
    duration: "1-4 hours"
    emoji: "\U0001F4DD"
    methodology: sdd
    checklist:
      - id: spec-created
        text: SPEC document created with ID
        textZh: å·²å»ºç«‹å¸¶ ID çš„ SPEC æ–‡ä»¶
        required: true
      - id: ac-linked
        text: Acceptance criteria linked to spec
        textZh: é©—æ”¶æ¢ä»¶å·²é€£çµåˆ°è¦æ ¼
        required: true
      - id: technical-design
        text: Technical design documented
        textZh: æŠ€è¡“è¨­è¨ˆå·²è¨˜éŒ„
        required: true
      - id: dependencies-listed
        text: Dependencies and risks identified
        textZh: ä¾è³´é …å’Œé¢¨éšªå·²è­˜åˆ¥
        required: false
    triggers:
      entry:
        - condition: acceptance_criteria_defined
          fromPhase: specification-workshop
      exit:
        - condition: spec_submitted
          nextPhase: spec-review
    guidance:
      prompt: |
        ## ğŸ“ Phase 2: Spec Proposal (SDD)

        **Goal**: Document HOW we'll build it technically.

        ### Spec Template
        ```markdown
        # [SPEC-XXX] Feature Title

        ## Summary
        Brief description of the proposed change.

        ## References
        - User Story: US-XXX
        - Acceptance Criteria: AC-1, AC-2, AC-3

        ## Motivation
        Why is this change needed?

        ## Detailed Design
        Technical approach, affected components.

        ## Dependencies
        - [External dependencies]

        ## Risks
        - [Potential risks]
        ```

        Write the technical specification based on the acceptance criteria.
      promptZh: |
        ## ğŸ“ éšæ®µ 2ï¼šè¦æ ¼ææ¡ˆ (SDD)

        **ç›®æ¨™**ï¼šè¨˜éŒ„æˆ‘å€‘å¦‚ä½•å¾æŠ€è¡“ä¸Šå»ºç«‹å®ƒã€‚

        ### è¦æ ¼æ¨¡æ¿
        ```markdown
        # [SPEC-XXX] åŠŸèƒ½æ¨™é¡Œ

        ## æ‘˜è¦
        æè­°è®Šæ›´çš„ç°¡è¦æè¿°ã€‚

        ## åƒè€ƒ
        - ä½¿ç”¨è€…æ•…äº‹ï¼šUS-XXX
        - é©—æ”¶æ¢ä»¶ï¼šAC-1ã€AC-2ã€AC-3

        ## å‹•æ©Ÿ
        ç‚ºä»€éº¼éœ€è¦é€™å€‹è®Šæ›´ï¼Ÿ

        ## è©³ç´°è¨­è¨ˆ
        æŠ€è¡“æ–¹æ³•ã€å—å½±éŸ¿çš„å…ƒä»¶ã€‚

        ## ä¾è³´é …
        - [å¤–éƒ¨ä¾è³´]

        ## é¢¨éšª
        - [æ½›åœ¨é¢¨éšª]
        ```

        æ ¹æ“šé©—æ”¶æ¢ä»¶æ’°å¯«æŠ€è¡“è¦æ ¼ã€‚
    reminders: []

  - id: spec-review
    name: Spec Review (SDD)
    nameZh: è¦æ ¼å¯©æŸ¥ (SDD)
    description: Technical review and approval of specification
    descriptionZh: è¦æ ¼çš„æŠ€è¡“å¯©æŸ¥å’Œæ‰¹å‡†
    duration: "1-2 days"
    emoji: "\U0001F50D"
    methodology: sdd
    checklist:
      - id: review-requested
        text: Review requested from stakeholders
        textZh: å·²å‘åˆ©å®³é—œä¿‚äººè«‹æ±‚å¯©æŸ¥
        required: true
      - id: feedback-addressed
        text: All feedback addressed
        textZh: æ‰€æœ‰å›é¥‹å·²è™•ç†
        required: true
      - id: spec-approved
        text: Spec approved by reviewers
        textZh: è¦æ ¼å·²ç”±å¯©æŸ¥è€…æ‰¹å‡†
        required: true
    triggers:
      entry:
        - condition: spec_submitted
          fromPhase: spec-proposal
      exit:
        - condition: spec_approved
          nextPhase: forward-derivation
        - condition: spec_rejected
          nextPhase: spec-proposal
    guidance:
      prompt: |
        ## ğŸ” Phase 3: Spec Review (SDD)

        **Goal**: Get technical approval for the design.

        ### Review Checklist
        - [ ] Design addresses all acceptance criteria
        - [ ] Technical approach is sound
        - [ ] Dependencies are manageable
        - [ ] Risks are acceptable

        Request review from the appropriate stakeholders.
      promptZh: |
        ## ğŸ” éšæ®µ 3ï¼šè¦æ ¼å¯©æŸ¥ (SDD)

        **ç›®æ¨™**ï¼šç²å¾—è¨­è¨ˆçš„æŠ€è¡“æ‰¹å‡†ã€‚

        ### å¯©æŸ¥æª¢æŸ¥æ¸…å–®
        - [ ] è¨­è¨ˆæ»¿è¶³æ‰€æœ‰é©—æ”¶æ¢ä»¶
        - [ ] æŠ€è¡“æ–¹æ³•æ˜¯åˆç†çš„
        - [ ] ä¾è³´é …æ˜¯å¯ç®¡ç†çš„
        - [ ] é¢¨éšªæ˜¯å¯æ¥å—çš„

        å‘é©ç•¶çš„åˆ©å®³é—œä¿‚äººè«‹æ±‚å¯©æŸ¥ã€‚
    reminders: []

  # Forward Derivation Phase
  - id: forward-derivation
    name: Forward Derivation
    nameZh: æ­£å‘æ¨æ¼”
    description: Automatically derive BDD scenarios and TDD test skeletons from approved spec
    descriptionZh: å¾å·²æ‰¹å‡†çš„è¦æ ¼è‡ªå‹•æ¨æ¼” BDD å ´æ™¯å’Œ TDD æ¸¬è©¦éª¨æ¶
    duration: "10-30 minutes"
    emoji: "\U0001F504"
    methodology: derivation
    checklist:
      - id: bdd-derived
        text: BDD scenarios derived from acceptance criteria
        textZh: å¾é©—æ”¶æ¢ä»¶æ¨æ¼” BDD å ´æ™¯
        required: true
      - id: tdd-skeleton-created
        text: TDD test skeleton created
        textZh: TDD æ¸¬è©¦éª¨æ¶å·²å»ºç«‹
        required: true
      - id: atdd-tables-generated
        text: ATDD acceptance test tables generated
        textZh: ATDD é©—æ”¶æ¸¬è©¦è¡¨æ ¼å·²ç”Ÿæˆ
        required: false
      - id: files-reviewed
        text: Generated files reviewed for accuracy
        textZh: å·²å¯©æŸ¥ç”Ÿæˆæª”æ¡ˆçš„æº–ç¢ºæ€§
        required: true
    triggers:
      entry:
        - condition: spec_approved
          fromPhase: spec-review
      exit:
        - condition: derivation_complete
          nextPhase: discovery
        - condition: skip_derivation
          nextPhase: discovery
    guidance:
      prompt: |
        ## ğŸ”„ Phase 3.5: Forward Derivation

        **Goal**: Auto-generate BDD/TDD/ATDD structures from approved spec.

        ### Commands Available
        | Command | Output | Purpose |
        |---------|--------|---------|
        | `/derive-bdd` | .feature | AC â†’ Gherkin |
        | `/derive-tdd` | .test.ts | AC â†’ Test skeleton |
        | `/derive-atdd` | acceptance.md | AC â†’ Test table |
        | `/derive-all` | All above | Full pipeline |

        ### Anti-Hallucination Check
        - SPEC has N acceptance criteria
        - Generated outputs must have exactly N items each

        Run `/derive-all specs/SPEC-XXX.md` to generate all test structures.
      promptZh: |
        ## ğŸ”„ éšæ®µ 3.5ï¼šæ­£å‘æ¨æ¼”

        **ç›®æ¨™**ï¼šå¾å·²æ‰¹å‡†çš„è¦æ ¼è‡ªå‹•ç”Ÿæˆ BDD/TDD/ATDD çµæ§‹ã€‚

        ### å¯ç”¨å‘½ä»¤
        | å‘½ä»¤ | è¼¸å‡º | ç”¨é€” |
        |------|------|------|
        | `/derive-bdd` | .feature | AC â†’ Gherkin |
        | `/derive-tdd` | .test.ts | AC â†’ æ¸¬è©¦éª¨æ¶ |
        | `/derive-atdd` | acceptance.md | AC â†’ æ¸¬è©¦è¡¨æ ¼ |
        | `/derive-all` | ä»¥ä¸Šå…¨éƒ¨ | å®Œæ•´ç®¡é“ |

        ### åå¹»è¦ºæª¢æŸ¥
        - SPEC æœ‰ N å€‹é©—æ”¶æ¢ä»¶
        - ç”Ÿæˆçš„è¼¸å‡ºå¿…é ˆå„æœ‰ N å€‹é …ç›®

        åŸ·è¡Œ `/derive-all specs/SPEC-XXX.md` ä»¥ç”Ÿæˆæ‰€æœ‰æ¸¬è©¦çµæ§‹ã€‚
    reminders: []

  # BDD Phases
  - id: discovery
    name: Discovery (BDD)
    nameZh: æ¢ç´¢ (BDD)
    description: Explore behavior through Three Amigos collaboration
    descriptionZh: é€éä¸‰åŠå®¢å”ä½œæ¢ç´¢è¡Œç‚º
    duration: "30-60 minutes"
    emoji: "\U0001F50E"
    methodology: bdd
    checklist:
      - id: three-amigos
        text: Three Amigos session conducted
        textZh: å·²é€²è¡Œä¸‰åŠå®¢æœƒè­°
        required: true
      - id: examples-mapped
        text: Examples mapped (rules, examples, questions)
        textZh: ç¯„ä¾‹å·²å°æ‡‰ï¼ˆè¦å‰‡ã€ç¯„ä¾‹ã€å•é¡Œï¼‰
        required: true
      - id: scenarios-identified
        text: Key scenarios identified
        textZh: é—œéµå ´æ™¯å·²è­˜åˆ¥
        required: true
    triggers:
      entry:
        - condition: derivation_complete
          fromPhase: forward-derivation
        - condition: skip_derivation
          fromPhase: forward-derivation
      exit:
        - condition: scenarios_identified
          nextPhase: formulation
    guidance:
      prompt: |
        ## ğŸ” Phase 4: Discovery (BDD)

        **Goal**: Explore behavior through conversation.

        ### Example Mapping
        | Color | Represents |
        |-------|------------|
        | Yellow | User Story |
        | Blue | Rules/AC |
        | Green | Examples |
        | Red | Questions |

        ### Three Amigos Questions
        - **Business**: Why? What value?
        - **Development**: How? Dependencies?
        - **Testing**: What could go wrong?

        Identify the key scenarios from the acceptance criteria.
      promptZh: |
        ## ğŸ” éšæ®µ 4ï¼šæ¢ç´¢ (BDD)

        **ç›®æ¨™**ï¼šé€éå°è©±æ¢ç´¢è¡Œç‚ºã€‚

        ### ç¯„ä¾‹å°æ‡‰
        | é¡è‰² | ä»£è¡¨ |
        |------|------|
        | é»ƒè‰² | ä½¿ç”¨è€…æ•…äº‹ |
        | è—è‰² | è¦å‰‡/AC |
        | ç¶ è‰² | ç¯„ä¾‹ |
        | ç´…è‰² | å•é¡Œ |

        ### ä¸‰åŠå®¢å•é¡Œ
        - **æ¥­å‹™**ï¼šç‚ºä»€éº¼ï¼Ÿæœ‰ä»€éº¼åƒ¹å€¼ï¼Ÿ
        - **é–‹ç™¼**ï¼šå¦‚ä½•åšï¼Ÿä¾è³´é …ï¼Ÿ
        - **æ¸¬è©¦**ï¼šä»€éº¼å¯èƒ½å‡ºéŒ¯ï¼Ÿ

        å¾é©—æ”¶æ¢ä»¶è­˜åˆ¥é—œéµå ´æ™¯ã€‚
    reminders: []

  - id: formulation
    name: Formulation (BDD)
    nameZh: åˆ¶å®š (BDD)
    description: Write Gherkin scenarios from discovered examples
    descriptionZh: å¾æ¢ç´¢çš„ç¯„ä¾‹æ’°å¯« Gherkin å ´æ™¯
    duration: "1-2 hours"
    emoji: "\U0001F4C4"
    methodology: bdd
    checklist:
      - id: gherkin-written
        text: Gherkin scenarios written
        textZh: Gherkin å ´æ™¯å·²æ’°å¯«
        required: true
      - id: declarative-language
        text: Scenarios use declarative language
        textZh: å ´æ™¯ä½¿ç”¨å®£å‘Šå¼èªè¨€
        required: true
      - id: scenarios-focused
        text: Each scenario tests ONE behavior
        textZh: æ¯å€‹å ´æ™¯æ¸¬è©¦ä¸€å€‹è¡Œç‚º
        required: true
      - id: po-reviews
        text: PO reviews scenarios for correctness
        textZh: PO å¯©æŸ¥å ´æ™¯çš„æ­£ç¢ºæ€§
        required: true
    triggers:
      entry:
        - condition: scenarios_identified
          fromPhase: discovery
      exit:
        - condition: scenarios_written
          nextPhase: tdd-red
    guidance:
      prompt: |
        ## ğŸ“„ Phase 5: Formulation (BDD)

        **Goal**: Convert examples to executable Gherkin scenarios.

        ### Gherkin Template
        ```gherkin
        Feature: [Feature name]

          Scenario: [Scenario name]
            Given [precondition]
            When [action]
            Then [expected outcome]
        ```

        ### Guidelines
        - Use business language, not technical terms
        - Keep scenarios to 3-5 steps
        - One behavior per scenario

        Write the Gherkin scenarios for the feature.
      promptZh: |
        ## ğŸ“„ éšæ®µ 5ï¼šåˆ¶å®š (BDD)

        **ç›®æ¨™**ï¼šå°‡ç¯„ä¾‹è½‰æ›ç‚ºå¯åŸ·è¡Œçš„ Gherkin å ´æ™¯ã€‚

        ### Gherkin æ¨¡æ¿
        ```gherkin
        Feature: [åŠŸèƒ½åç¨±]

          Scenario: [å ´æ™¯åç¨±]
            Given [å‰ç½®æ¢ä»¶]
            When [å‹•ä½œ]
            Then [é æœŸçµæœ]
        ```

        ### æŒ‡å—
        - ä½¿ç”¨æ¥­å‹™èªè¨€ï¼Œè€ŒéæŠ€è¡“è¡“èª
        - ä¿æŒå ´æ™¯åœ¨ 3-5 å€‹æ­¥é©Ÿ
        - æ¯å€‹å ´æ™¯ä¸€å€‹è¡Œç‚º

        ç‚ºåŠŸèƒ½æ’°å¯« Gherkin å ´æ™¯ã€‚
    reminders: []

  # TDD Phases
  - id: tdd-red
    name: Red Phase (TDD)
    nameZh: ç´…ç‡ˆéšæ®µ (TDD)
    description: Write failing tests based on scenarios
    descriptionZh: æ ¹æ“šå ´æ™¯æ’°å¯«å¤±æ•—çš„æ¸¬è©¦
    duration: "1-5 minutes per test"
    emoji: "\U0001F534"
    methodology: tdd
    checklist:
      - id: test-written
        text: Test written for ONE behavior
        textZh: ç‚ºä¸€å€‹è¡Œç‚ºæ’°å¯«æ¸¬è©¦
        required: true
      - id: test-fails
        text: Test fails for the RIGHT reason
        textZh: æ¸¬è©¦å› æ­£ç¢ºçš„åŸå› å¤±æ•—
        required: true
      - id: descriptive-name
        text: Test has descriptive name
        textZh: æ¸¬è©¦æœ‰æè¿°æ€§åç¨±
        required: true
    triggers:
      entry:
        - condition: scenarios_written
          fromPhase: formulation
        - condition: test_passes
          fromPhase: tdd-refactor
      exit:
        - condition: test_fails
          nextPhase: tdd-green
    guidance:
      prompt: |
        ## ğŸ”´ Phase 6: Red (TDD)

        **Goal**: Write a failing test that describes expected behavior.

        ### Test Guidelines
        - Test ONE behavior at a time
        - Use Arrange-Act-Assert pattern
        - Descriptive test name: `should_[behavior]_when_[condition]`

        Write the failing test.
      promptZh: |
        ## ğŸ”´ éšæ®µ 6ï¼šç´…ç‡ˆ (TDD)

        **ç›®æ¨™**ï¼šæ’°å¯«æè¿°é æœŸè¡Œç‚ºçš„å¤±æ•—æ¸¬è©¦ã€‚

        ### æ¸¬è©¦æŒ‡å—
        - ä¸€æ¬¡æ¸¬è©¦ä¸€å€‹è¡Œç‚º
        - ä½¿ç”¨ Arrange-Act-Assert æ¨¡å¼
        - æè¿°æ€§æ¸¬è©¦åç¨±ï¼š`should_[è¡Œç‚º]_when_[æ¢ä»¶]`

        æ’°å¯«å¤±æ•—çš„æ¸¬è©¦ã€‚
    reminders:
      - trigger: "time_elapsed > 10min"
        message: "Taking too long in RED. Is the test scope too large?"
        messageZh: "ç´…ç‡ˆéšæ®µè€—æ™‚éé•·ã€‚æ¸¬è©¦ç¯„åœæ˜¯å¦å¤ªå¤§ï¼Ÿ"

  - id: tdd-green
    name: Green Phase (TDD)
    nameZh: ç¶ ç‡ˆéšæ®µ (TDD)
    description: Write minimum code to pass the test
    descriptionZh: æ’°å¯«æœ€å°ç¨‹å¼ç¢¼ä½¿æ¸¬è©¦é€šé
    duration: "1-10 minutes"
    emoji: "\U0001F7E2"
    methodology: tdd
    checklist:
      - id: minimum-code
        text: MINIMUM code written to pass
        textZh: æ’°å¯«æœ€å°ç¨‹å¼ç¢¼ä½¿é€šé
        required: true
      - id: test-passes
        text: Test passes
        textZh: æ¸¬è©¦é€šé
        required: true
      - id: no-extra-features
        text: No extra features added
        textZh: æœªæ·»åŠ é¡å¤–åŠŸèƒ½
        required: true
    triggers:
      entry:
        - condition: test_fails
          fromPhase: tdd-red
      exit:
        - condition: test_passes
          nextPhase: tdd-refactor
    guidance:
      prompt: |
        ## ğŸŸ¢ Phase 7: Green (TDD)

        **Goal**: Write MINIMUM code to make the test pass.

        ### Guidelines
        - "Fake it till you make it" is acceptable
        - Don't over-engineer
        - Just make it work

        Implement the minimum code to pass the test.
      promptZh: |
        ## ğŸŸ¢ éšæ®µ 7ï¼šç¶ ç‡ˆ (TDD)

        **ç›®æ¨™**ï¼šæ’°å¯«æœ€å°ç¨‹å¼ç¢¼ä½¿æ¸¬è©¦é€šéã€‚

        ### æŒ‡å—
        - ã€Œå‡è£ç›´åˆ°æˆåŠŸã€æ˜¯å¯æ¥å—çš„
        - ä¸è¦éåº¦å·¥ç¨‹åŒ–
        - åªè¦è®“å®ƒèƒ½é‹ä½œ

        å¯¦ä½œæœ€å°ç¨‹å¼ç¢¼ä½¿æ¸¬è©¦é€šéã€‚
    reminders:
      - trigger: "time_elapsed > 15min"
        message: "Taking too long in GREEN. Break down the problem."
        messageZh: "ç¶ ç‡ˆéšæ®µè€—æ™‚éé•·ã€‚æ‹†åˆ†å•é¡Œã€‚"

  - id: tdd-refactor
    name: Refactor Phase (TDD)
    nameZh: é‡æ§‹éšæ®µ (TDD)
    description: Improve code while keeping tests green
    descriptionZh: æ”¹é€²ç¨‹å¼ç¢¼åŒæ™‚ä¿æŒæ¸¬è©¦é€šé
    duration: "5-15 minutes"
    emoji: "\U0001F535"
    methodology: tdd
    checklist:
      - id: tests-still-pass
        text: All tests still pass
        textZh: æ‰€æœ‰æ¸¬è©¦ä»ç„¶é€šé
        required: true
      - id: duplication-removed
        text: Duplication removed (DRY)
        textZh: é‡è¤‡å·²æ¶ˆé™¤ (DRY)
        required: false
      - id: names-improved
        text: Names are clear
        textZh: å‘½åæ¸…æ™°
        required: false
    triggers:
      entry:
        - condition: test_passes
          fromPhase: tdd-green
      exit:
        - condition: all_bdd_scenarios_pass
          nextPhase: demo
        - condition: more_tests_needed
          nextPhase: tdd-red
    guidance:
      prompt: |
        ## ğŸ”µ Phase 8: Refactor (TDD)

        **Goal**: Improve code quality while keeping tests green.

        ### Refactoring Checklist
        - [ ] Remove duplication (DRY)
        - [ ] Improve naming
        - [ ] Extract methods if needed
        - [ ] Run tests after each change

        Refactor the code. If more behaviors need testing, return to RED.
      promptZh: |
        ## ğŸ”µ éšæ®µ 8ï¼šé‡æ§‹ (TDD)

        **ç›®æ¨™**ï¼šæ”¹é€²ç¨‹å¼ç¢¼å“è³ªåŒæ™‚ä¿æŒæ¸¬è©¦é€šéã€‚

        ### é‡æ§‹æª¢æŸ¥æ¸…å–®
        - [ ] æ¶ˆé™¤é‡è¤‡ (DRY)
        - [ ] æ”¹é€²å‘½å
        - [ ] å¦‚éœ€è¦æå–æ–¹æ³•
        - [ ] æ¯æ¬¡è®Šæ›´å¾ŒåŸ·è¡Œæ¸¬è©¦

        é‡æ§‹ç¨‹å¼ç¢¼ã€‚å¦‚æœé‚„æœ‰æ›´å¤šè¡Œç‚ºéœ€è¦æ¸¬è©¦ï¼Œè¿”å›ç´…ç‡ˆéšæ®µã€‚
    reminders: []

  # Verification Phases
  - id: demo
    name: Demo & Acceptance
    nameZh: å±•ç¤ºèˆ‡é©—æ”¶
    description: Demonstrate feature to stakeholders for acceptance
    descriptionZh: å‘åˆ©å®³é—œä¿‚äººå±•ç¤ºåŠŸèƒ½ä»¥ç²å¾—é©—æ”¶
    duration: "15-30 minutes"
    emoji: "\U0001F3AC"
    methodology: atdd
    checklist:
      - id: all-tests-pass
        text: All acceptance tests pass
        textZh: æ‰€æœ‰é©—æ”¶æ¸¬è©¦é€šé
        required: true
      - id: demo-prepared
        text: Demo environment prepared
        textZh: å±•ç¤ºç’°å¢ƒå·²æº–å‚™
        required: true
      - id: po-accepts
        text: Product Owner accepts feature
        textZh: ç”¢å“è² è²¬äººæ¥å—åŠŸèƒ½
        required: true
    triggers:
      entry:
        - condition: all_bdd_scenarios_pass
          fromPhase: tdd-refactor
      exit:
        - condition: feature_accepted
          nextPhase: archive
        - condition: criteria_refined
          nextPhase: specification-workshop
    guidance:
      prompt: |
        ## ğŸ¬ Phase 9: Demo & Acceptance

        **Goal**: Get formal acceptance from Product Owner.

        ### Demo Structure
        1. Context (1 min) - Remind story and AC
        2. Tests (2 min) - Run tests live
        3. Feature (5-10 min) - Walk through AC
        4. Feedback (5 min) - Q&A

        ### Outcomes
        - âœ… Accepted â†’ Archive
        - ğŸ”„ Refinement â†’ Return to Workshop

        Prepare and conduct the demo.
      promptZh: |
        ## ğŸ¬ éšæ®µ 9ï¼šå±•ç¤ºèˆ‡é©—æ”¶

        **ç›®æ¨™**ï¼šå¾ç”¢å“è² è²¬äººç²å¾—æ­£å¼æ¥å—ã€‚

        ### å±•ç¤ºçµæ§‹
        1. èƒŒæ™¯ (1 åˆ†é˜) - æé†’æ•…äº‹å’Œ AC
        2. æ¸¬è©¦ (2 åˆ†é˜) - ç¾å ´åŸ·è¡Œæ¸¬è©¦
        3. åŠŸèƒ½ (5-10 åˆ†é˜) - èµ°é AC
        4. å›é¥‹ (5 åˆ†é˜) - Q&A

        ### çµæœ
        - âœ… æ¥å— â†’ æ­¸æª”
        - ğŸ”„ ç²¾ç…‰ â†’ è¿”å›å·¥ä½œåŠ

        æº–å‚™ä¸¦é€²è¡Œå±•ç¤ºã€‚
    reminders: []

  - id: archive
    name: Archive & Complete
    nameZh: æ­¸æª”èˆ‡å®Œæˆ
    description: Archive spec, close story, merge code
    descriptionZh: æ­¸æª”è¦æ ¼ã€é—œé–‰æ•…äº‹ã€åˆä½µç¨‹å¼ç¢¼
    duration: "15-30 minutes"
    emoji: "\u2705"
    methodology: sdd
    checklist:
      - id: spec-archived
        text: Spec archived with PR/commit links
        textZh: è¦æ ¼å·²æ­¸æª”ä¸¦é€£çµ PR/commit
        required: true
      - id: story-closed
        text: User story closed
        textZh: ä½¿ç”¨è€…æ•…äº‹å·²é—œé–‰
        required: true
      - id: code-merged
        text: Code merged to main branch
        textZh: ç¨‹å¼ç¢¼å·²åˆä½µåˆ°ä¸»åˆ†æ”¯
        required: true
    triggers:
      entry:
        - condition: feature_accepted
          fromPhase: demo
      exit: []
    guidance:
      prompt: |
        ## âœ… Phase 10: Archive & Complete

        **Goal**: Close out the feature properly.

        ### Checklist
        1. Archive spec with implementation links
        2. Close user story
        3. Merge code to main
        4. Update documentation if needed

        Congratulations! Feature complete.
      promptZh: |
        ## âœ… éšæ®µ 10ï¼šæ­¸æª”èˆ‡å®Œæˆ

        **ç›®æ¨™**ï¼šæ­£ç¢ºçµæŸåŠŸèƒ½ã€‚

        ### æª¢æŸ¥æ¸…å–®
        1. æ­¸æª”è¦æ ¼ä¸¦é€£çµå¯¦ä½œ
        2. é—œé–‰ä½¿ç”¨è€…æ•…äº‹
        3. åˆä½µç¨‹å¼ç¢¼åˆ° main
        4. å¦‚éœ€è¦æ›´æ–°æ–‡ä»¶

        æ­å–œï¼åŠŸèƒ½å®Œæˆã€‚
    reminders: []

checkpoints:
  - id: phase-complete
    trigger: phase_transition
    intensity: suggest
    action: |
      Phase {{current_phase}} completed.

      Integrated Flow Progress: {{current_phase_index}}/10 phases
      Feature: {{feature_title}}

      [1] Continue to next phase  [2] View status  [3] Commit changes
    actionZh: |
      éšæ®µ {{current_phase}} å®Œæˆã€‚

      æ•´åˆæµç¨‹é€²åº¦ï¼š{{current_phase_index}}/10 å€‹éšæ®µ
      åŠŸèƒ½ï¼š{{feature_title}}

      [1] ç¹¼çºŒä¸‹ä¸€éšæ®µ  [2] æª¢è¦–ç‹€æ…‹  [3] æäº¤è®Šæ›´

  - id: tdd-cycle-stuck
    trigger: "time_in_tdd_phase > 30min"
    intensity: warning
    action: |
      Warning: Stuck in TDD cycle for 30+ minutes.

      Consider:
      - Breaking into smaller behaviors
      - Revisiting BDD scenarios
      - Asking for help
    actionZh: |
      è­¦å‘Šï¼šåœ¨ TDD å¾ªç’°ä¸­è¶…é 30 åˆ†é˜ã€‚

      è€ƒæ…®ï¼š
      - æ‹†åˆ†æˆæ›´å°çš„è¡Œç‚º
      - é‡æ–°æª¢è¦– BDD å ´æ™¯
      - å°‹æ±‚å¹«åŠ©

commands:
  - name: integrated-flow
    description: Start integrated ATDDâ†’SDDâ†’BDDâ†’TDD workflow
    descriptionZh: å•Ÿå‹•æ•´åˆçš„ ATDDâ†’SDDâ†’BDDâ†’TDD å·¥ä½œæµç¨‹
    usage: "/integrated-flow [feature]"
    action: start_workflow
  - name: flow-status
    description: Show current phase in integrated flow
    descriptionZh: é¡¯ç¤ºæ•´åˆæµç¨‹çš„ç•¶å‰éšæ®µ
    usage: "/flow-status"
    action: show_status
  - name: flow-skip
    description: Skip to a specific phase (advanced)
    descriptionZh: è·³è‡³ç‰¹å®šéšæ®µï¼ˆé€²éšï¼‰
    usage: "/flow-skip [phase-id]"
    action: skip_phase

integrations:
  atdd:
    enabled: true
    phases: [specification-workshop, demo]
  sdd:
    enabled: true
    phases: [spec-proposal, spec-review, archive]
  forward-derivation:
    enabled: true
    phases: [forward-derivation]
  bdd:
    enabled: true
    phases: [discovery, formulation]
  tdd:
    enabled: true
    phases: [tdd-red, tdd-green, tdd-refactor]
  checkin-standards:
    enabled: true
    mapping:
      phase_complete: suggest_commit
  code-review:
    enabled: true
    additionalChecks:
      - "All acceptance criteria have tests"
      - "Spec is approved and linked"
      - "BDD scenarios pass"

aiGuidance:
  autoDetect: true
  proactiveReminders: true
  contextKeywords:
    - "integrated flow"
    - "full workflow"
    - "ATDD to TDD"
    - "complete development"
    - "acceptance to unit"
    - "forward derivation"
    - "derive from spec"
    - "spec to test"
