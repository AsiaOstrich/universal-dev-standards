# 變基快進 - AI 優化選項
# 父項: git-workflow

id: rebase-ff
meta:
  parent: git-workflow
  version: "1.0.0"
  description: 變基然後快進合併以獲得線性歷史
  language: zh-TW

best_for:
  - 完美線性歷史
  - 主幹開發
  - 短期功能分支
  - 資深 Git 使用者

characteristics:
  history: 完全線性
  commit_count: 保留所有提交（重寫）
  reversibility: 需要還原每個提交
  bisect_friendly: 優秀

rules:
  - id: never-rebase-shared
    trigger: 變基時
    instruction: 永不變基已推送/共享的分支
    priority: required

  - id: rebase-before-merge
    trigger: 合併前
    instruction: 總是在合併前變基到最新 main
    priority: required

  - id: clean-commits
    trigger: 變基前
    instruction: 確保提交是原子性且有意義的
    priority: recommended

  - id: interactive-rebase
    trigger: 清理歷史時
    instruction: 使用互動式變基壓縮 WIP 提交
    priority: recommended

workflow:
  - step: 建立功能分支
    commands:
      - git checkout main
      - git checkout -b feature/{功能名稱}

  - step: 進行提交
    commands:
      - git commit -m "feat: implement feature part 1"
      - git commit -m "feat: implement feature part 2"

  - step: 變基到最新 main
    commands:
      - git fetch origin
      - git rebase origin/main

  - step: 快進合併
    commands:
      - git checkout main
      - git merge --ff-only feature/{功能名稱}

  - step: 推送並刪除分支
    commands:
      - git push origin main
      - git branch -d feature/{功能名稱}

interactive_rebase:
  description: 清理提交歷史
  commands:
    - git rebase -i HEAD~3
  actions:
    - pick: 保留提交原樣
    - reword: 變更提交訊息
    - squash: 與前一個合併
    - fixup: 與前一個合併（丟棄訊息）
    - drop: 移除提交

example:
  before: |
    main: A---B---C
                   \
    feature:        D---E---F
  after_rebase: |
    main: A---B---C
                   \
    feature:        D'---E'---F'
  after_ff: |
    main: A---B---C---D'---E'---F'

pros:
  - 完美線性歷史
  - 每個提交都有意義
  - 優秀的 bisect 支援
  - 乾淨的 git log

cons:
  - 重寫歷史風險
  - 需要更多 Git 知識
  - 不適合共享分支
  - 合併衝突需解決多次

quick_reference:
  commands:
    columns: [操作, 指令]
    rows:
      - [變基到 main, "git rebase origin/main"]
      - [互動式變基, "git rebase -i HEAD~n"]
      - [快進合併, "git merge --ff-only branch"]
      - [中止變基, "git rebase --abort"]
      - [繼續變基, "git rebase --continue"]
