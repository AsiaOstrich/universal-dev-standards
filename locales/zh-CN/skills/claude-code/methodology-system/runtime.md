---
source: ../../../../../skills/claude-code/methodology-system/runtime.md
source_version: 1.0.0
translation_version: 1.0.0
last_synced: 2026-01-12
status: experimental
---

# 方法論执行时引導

> **Language**: [English](../../../../../skills/claude-code/methodology-system/runtime.md) | 简体中文

> [!WARNING]
> **实驗性功能 / Experimental Feature**
>
> 此功能正在積極开发中，可能在 v4.0 中有重大变更。
> This feature is under active development and may change significantly in v4.0.

**版本**: 1.0.0
**最後更新**: 2026-01-12

---

## 概述

本文件定義當开发方法論啟用时，AI 助手应如何行为。提供阶段追蹤、检查点处理和用戶互动的引導。

---

## AI 行为規格

### 1. 上下文感知

當方法論啟用时，AI 应該：

- **始終知道當前阶段**
- **在响应中顯示阶段指示器**
- **建议阶段適當的行动**

#### 阶段状态顯示

在相关响应開頭包含方法論状态：

```
┌────────────────────────────────────────────────┐
│ 📋 方法論: TDD                                  │
│ 📍 阶段: 🔴 紅燈（撰写失败的测试）               │
│ ⏱️  持續时间: 3 分鐘                            │
└────────────────────────────────────────────────┘
```

### 2. 主动引導

根据當前阶段提供上下文適當的建议：

```markdown
**當前阶段: 🔴 紅燈 (TDD)**

您正在为以下功能撰写失败的测试：用戶登入验证

**下一步**：撰写描述预期行为的测试。

您希望我：
1. 产生测试骨架
2. 展示此場景的 TDD 最佳实踐
3. 繼續您的手动方式
```

### 3. 阶段转换偵测

監控表示阶段转换的条件：

| 訊号 | 转换 |
|------|------|
| 测试执行失败 | 紅燈 → 准备进入綠燈 |
| 所有测试通過 | 綠燈 → 准备重構 |
| 用戶确认重構完成 | 重構 → 下一个周期或完成 |
| 經過时间超過阶段持續时间 | 顯示提醒 |
| 偵测到 Git 提交 | 重置阶段计时器 |

### 4. 检查点行为

當检查点条件觸發时，顯示检查点通知：

```
┌────────────────────────────────────────────────┐
│ 🔔 方法論检查点                                 │
├────────────────────────────────────────────────┤
│ 綠燈阶段完成                                    │
│                                                │
│ 检查清单状态：                                  │
│   ✅ 撰写最少程序码                            │
│   ✅ 测试通過                                   │
│   ✅ 所有其他测试通過                           │
│   ⬜ （選填）考慮邊界情况                       │
│                                                │
│ 变更统计：                                      │
│   - 文件: 3                                     │
│   - 新增: 45 行                                 │
│   - 刪除: 2 行                                  │
│                                                │
│ 建议提交：                                      │
│   test(auth): 新增郵箱验证测试                  │
│   feat(auth): 实作郵箱验证                      │
│                                                │
│ 选项：                                          │
│   [1] 立即提交（顯示 git 命令）                 │
│   [2] 繼續到重構阶段                            │
│   [3] 檢视详细变更                              │
└────────────────────────────────────────────────┘
```

### 5. 跳過追蹤

追蹤連續跳過并適當警告：

| 跳過次數 | 行动 |
|----------|------|
| 1-2 | 無行动，记录跳過 |
| 3 | 警告通知 |
| 4+ | 強烈警告，建议提交 |

#### 跳過警告顯示

```
┌────────────────────────────────────────────────┐
│ ⚠️ 跳過警告                                     │
├────────────────────────────────────────────────┤
│ 您已連續跳過簽入 3 次                           │
│                                                │
│ 當前累積变更：                                  │
│   - 文件: 8                                     │
│   - 新增: 320 行                                │
│   - 刪除: 45 行                                 │
│                                                │
│ 建议：立即提交您的变更以避免遺失工作并維持      │
│ 原子化提交。                                    │
│                                                │
│ [1] 立即提交  [2] 仍然跳過  [3] 檢视差異        │
└────────────────────────────────────────────────┘
```

---

## 方法論偵测

### 自动偵测

AI 应從以下來源偵测方法論上下文：

1. **Manifest 配置**
   ```json
   // .standards/manifest.json
   { "methodology": { "active": "tdd" } }
   ```

2. **关鍵字偵测**
   - 「讓我們用 TDD 來做这个」
   - 「先写一个失败的测试」
   - 「Given-When-Then」
   - 「为这个变更建立規格」

3. **命令調用**
   - `/tdd`、`/bdd`、`/spec`、`/atdd`
   - `/methodology switch <id>`

### 载入方法論定義

```
方法論载入優先順序：
1. 自订: .standards/methodologies/{id}.methodology.yaml
2. 內建: methodologies/{id}.methodology.yaml
3. 备用: 通用無阶段工作流
```

---

## 检查清单管理

### 顯示格式

```markdown
### 阶段检查清单

**必須：**
- [ ] 测试描述预期行为
- [x] 测试名称清晰
- [ ] 测试遵循 AAA 模式

**選填：**
- [ ] 考慮邊界情况
```

### 追蹤

- 根据用戶行动和程序码分析更新检查清单项目
- 嚴格模式下，必填项目未完成則阻止阶段转换
- 记录完成情况以供审计追蹤

---

## 集成点

### 与 Git

- 偵测提交以重置阶段计时器
- 根据方法論建议提交消息
- 自动包含規格/故事參考

### 与测试执行器

- 偵测测试通過/失败以觸發阶段转换
- 报告与當前阶段相关的测试覆蓋率

### 与程序码审查

- 添加方法論特定的审查检查
- 在 PR 描述中參考啟用的方法論

---

## 错误处理

### 找不到方法論

```
⚠️ 找不到方法論 'custom-workflow'。

可用的方法論：
- tdd（內建）
- bdd（內建）
- sdd（內建）
- atdd（內建）

使用 `/methodology list` 查看所有选项。
```

### 無效的阶段转换

```
⚠️ 無法從紅燈转换到重構。

TDD 要求：紅燈 → 綠燈 → 重構

當前阶段：紅燈
有效的下一个阶段：綠燈

請先完成紅燈阶段的检查清单。
```

---

## 效能考量

- 首次载入後快取方法論定義
- 僅在 manifest 变更时重新载入
- 最小化检查点頻率以避免中斷
- 批次处理 git 状态检查

---

## 本地化

所有面向用戶的文字应使用適當的语言欄位：

```yaml
# 如果用戶的地區设置是 zh-TW
name: nameZh || name
description: descriptionZh || description
prompt: promptZh || prompt
```

---

## 版本历史

| 版本 | 日期 | 变更 |
|------|------|------|
| 1.0.0 | 2026-01-12 | 初始执行时規格 |
