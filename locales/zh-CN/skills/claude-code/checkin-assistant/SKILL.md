---
source: skills/claude-code/checkin-assistant/SKILL.md
source_version: 1.0.0
translation_version: 1.0.0
last_synced: 2026-01-12
status: current
name: checkin-assistant
description: |
  引导提交前质量关卡和签入工作流程。
  使用时机：提交代码、准备提交、质量关卡验证。
  关键字：commit, checkin, pre-commit, quality gate, git add, 提交, 签入, 质量关卡.
---

# 签入助手

> **语言**：[English](../../../../../skills/claude-code/checkin-assistant/SKILL.md) | 简体中文

**版本**：1.0.0
**最后更新**：2026-01-12
**适用范围**：Claude Code Skills

---

## 目的

此技能引导开发人员完成提交前的质量关卡，确保每次提交都能维护代码库的稳定性并遵循最佳实践。

**注意**：此技能专注于**何时以及如何提交**。有关 PR 期间的代码审查，请参阅[代码审查助手](../code-review-assistant/SKILL.md)。

---

## 快速参考（YAML 压缩格式）

```yaml
# === 核心理念 ===
每次提交应该:
  - "是一个完整的逻辑工作单元"
  - "让代码库保持可运行状态"
  - "可以回滚而不破坏功能"
  - "包含自己的测试（新功能）"
  - "让未来的开发者能够理解"

# === 强制检查清单 ===
checklist:
  构建:
    - "代码编译成功（零错误）"
    - "所有依赖包已满足"
    验证: "执行构建命令，退出码为 0"

  测试:
    - "所有现有测试通过（100%）"
    - "新代码有对应测试"
    - "覆盖率没有下降"
    验证: "执行测试套件，检查覆盖率"

  质量:
    - "遵循编码标准"
    - "无代码异味（方法≤50行，嵌套≤3层，复杂度≤10）"
    - "无硬编码的密钥"
    - "无安全漏洞"
    验证: "执行 linter、安全扫描器"

  文档:
    - "API 文档已更新"
    - "README 已更新（如需要）"
    - "CHANGELOG 已更新（用户可见变更 → [Unreleased]）"

  工作流程:
    - "分支命名正确（feature/, fix/, docs/, chore/）"
    - "提交信息格式正确（conventional commits）"
    - "已与目标分支同步"

# === 绝不在以下情况提交 ===
阻挡条件:
  - "构建有错误"
  - "测试失败"
  - "功能不完整（会破坏功能）"
  - "关键逻辑中包含 WIP/TODO"
  - "包含调试代码（console.log, print）"
  - "包含被注释的代码块"

# === 提交时机 ===
好的时机:
  - 完成单元: "功能完整实现并附带测试"
  - 修复错误: "错误已修复并有回归测试"
  - 独立重构: "重构完成，所有测试通过"
  - 可运行状态: "代码编译通过，应用程序可执行"

不好的时机:
  - "构建失败"
  - "测试失败"
  - "功能不完整"
  - "实验性代码散布着 TODO"

# === 粒度 ===
理想提交:
  文件数: "1-10（超过 10 则考虑拆分）"
  行数: "50-300"
  范围: "单一关注点"

拆分原则:
  合并: ["功能 + 其测试", "紧密相关的多文件变更"]
  分开: ["功能 A + B", "重构 + 新功能", "错误修复 + 顺便重构"]

# === 特殊情境 ===
紧急离开:
  建议: "git stash save 'WIP: 描述'"
  替代方案: "创建 wip/ 分支"
  禁止: "直接在功能分支上提交 WIP"

实验性开发:
  分支: "experiment/主题名称"
  规则: "自由提交（无严格格式）"
  成功: "清理、压缩、合并到功能分支"
  失败: "记录教训、删除分支"

紧急修复:
  分支: "hotfix/问题名称，从 main 分出"
  规则: "最小化变更，只修复问题"
  信息: "fix(scope): [URGENT] 描述"
```

---

## 检查清单视觉格式

每次提交前使用此检查清单：

```
┌─────────────────────────────────────────────────────────────────┐
│  📋 提交前检查清单                                               │
├─────────────────────────────────────────────────────────────────┤
│  🔨 构建                                                        │
│  □ 代码编译成功（零错误）                                        │
│  □ 所有依赖包已满足                                              │
├─────────────────────────────────────────────────────────────────┤
│  🧪 测试                                                        │
│  □ 所有现有测试通过（100%）                                      │
│  □ 新代码有对应测试                                              │
│  □ 测试覆盖率没有下降                                            │
├─────────────────────────────────────────────────────────────────┤
│  ✨ 代码质量                                                     │
│  □ 遵循项目编码标准                                              │
│  □ 无硬编码的密钥或凭证                                          │
│  □ 无安全漏洞                                                    │
├─────────────────────────────────────────────────────────────────┤
│  📝 文档                                                        │
│  □ API 文档已更新（如适用）                                      │
│  □ CHANGELOG 已更新（用户可见变更）                              │
├─────────────────────────────────────────────────────────────────┤
│  🔄 工作流程                                                     │
│  □ 分支命名遵循规范                                              │
│  □ 提交信息遵循 conventional commits                             │
│  □ 已与目标分支同步（无冲突）                                    │
└─────────────────────────────────────────────────────────────────┘
```

---

## 签入触发点

### 何时提示提交

| 触发条件 | 状况 | 提醒强度 |
|---------|------|----------|
| 阶段完成 | 完成一个开发阶段 | 建议 |
| 检查点 | 达到定义的检查点 | 建议 |
| 变更累积 | 文件 ≥5 或行数 ≥200 | 建议 |
| 连续跳过 | 连续跳过提交 3 次 | 警告 |
| 工作完成 | 完成前有未提交的变更 | 强烈建议 |

### 提醒格式

```
┌────────────────────────────────────────────────┐
│ 🔔 签入检查点                                   │
├────────────────────────────────────────────────┤
│ 阶段 1 已完成                                   │
│                                                │
│ 变更统计：                                      │
│   - 文件数：5                                   │
│   - 新增：180 行                                │
│   - 删除：12 行                                 │
│                                                │
│ 测试状态：✅ 通过                               │
│                                                │
│ 建议的提交信息：                                │
│   feat(module): 完成阶段 1 设置                 │
│                                                │
│ 选项：                                          │
│   [1] 现在提交（会显示 git 命令）               │
│   [2] 稍后提交，继续下一阶段                    │
│   [3] 查看详细变更                              │
└────────────────────────────────────────────────┘
```

### 跳过警告

连续跳过 3 次后：

```
⚠️ 警告：您已连续跳过签入 3 次
当前累积变更：15 个文件，+520 行
建议尽快提交，避免变更过大难以审查
```

---

## AI 助手工作流程

当 AI 完成代码变更时，遵循此工作流程：

### 步骤 1：评估时机

```
✅ 完整："实现了用户注册，包含验证、测试和文档"
⚠️ 不完整："添加了注册表单，但后端验证尚未完成"
❌ 未就绪："开始处理注册功能，还有多个 TODO"
```

### 步骤 2：执行检查清单

```
### 检查清单结果

✅ 构建：npm run build 成功
✅ 代码质量：遵循项目标准
⚠️ 测试：单元测试通过，集成测试需要验证
✅ 文档：已添加 JSDoc 注释
✅ 提交信息：已按照 conventional commits 格式准备
```

### 步骤 3：提示用户

```markdown
## 请确认签入

已完成：[简短描述]

### 检查清单结果
✅ 构建通过
✅ 测试通过
✅ 代码质量已验证
✅ 文档已更新

建议的提交信息：
```
feat(auth): 添加 OAuth2 Google 登录支持

- 实现 Google 提供者的 OAuth2 流程
- 添加用户会话管理
- 包含 auth 服务的单元测试

Refs #123
```

是否继续提交？
```

### 步骤 4：等待确认

**AI 必须**：
- ✅ 等待用户明确同意
- ✅ 提供清晰的检查清单摘要
- ✅ 允许用户拒绝或要求修改

**AI 不得**：
- ❌ 自动执行 `git add`
- ❌ 自动执行 `git commit`
- ❌ 自动执行 `git push`

---

## 常见违规

### ❌ WIP 提交

```bash
# 不好
git commit -m "WIP"
git commit -m "save work"

# 解决方案：使用 git stash
git stash save "WIP: 功能描述"
```

### ❌ 注释的代码

```javascript
// 不好：提交被注释的旧代码
// const oldValue = calculate(x);
const newValue = calculateV2(x);

// 解决方案：删除注释的代码，依赖 git 历史
const newValue = calculateV2(x);
```

### ❌ 混合关注点

```bash
# 不好：一个提交包含多个不相关的变更
git commit -m "fix bug and refactor and add feature"

# 解决方案：分开提交
git commit -m "fix(module-a): 解决空指针问题"
git commit -m "refactor(module-b): 提取验证逻辑"
git commit -m "feat(module-c): 添加 CSV 导出"
```

---

## 目录卫生

提交前，验证没有不需要的文件：

```bash
# 检查暂存区中的 IDE 产出物
git diff --cached --name-only | grep -E '\.idea|\.vs/|\.DS_Store'

# 检查异常目录
git ls-files | grep -E '^\$'

# 取消暂存不需要的文件
git reset HEAD <file>
```

### 常见应排除的产出物

| 模式 | 来源 | 处理方式 |
|------|------|----------|
| `.idea/` | JetBrains | gitignore |
| `.vs/` | Visual Studio | gitignore |
| `.DS_Store` | macOS | gitignore |
| `Thumbs.db` | Windows | gitignore |

---

## 配置检测

### 检测顺序

1. 检查 `CONTRIBUTING.md` 的「Disabled Skills」区段
2. 检查 `CONTRIBUTING.md` 的「Check-in Standards」区段
3. 检查 pre-commit hooks 配置
4. 如果都没找到，**使用标准检查清单**

### 首次设置

如果没有找到配置：

1. 建议在 `CONTRIBUTING.md` 中记录：

```markdown
## 签入标准

### 构建命令
```bash
npm run build
```

### 测试命令
```bash
npm test
```

### 质量命令
```bash
npm run lint
```

### 最低覆盖率
- 行覆盖率：80%
- 分支覆盖率：75%
```

---

## 详细指南

完整标准请参见：
- [签入标准](../../../core/checkin-standards.md)

---

## 相关标准

- [签入标准](../../../core/checkin-standards.md) - 核心标准
- [提交信息指南](../../../core/commit-message-guide.md) - 信息格式
- [代码审查检查清单](../../../core/code-review-checklist.md) - PR 审查
- [代码审查助手](../code-review-assistant/SKILL.md) - 审查技能
- [提交标准技能](../commit-standards/SKILL.md) - 提交信息技能

---

## 版本历史

| 版本 | 日期 | 变更 |
|------|------|------|
| 1.0.0 | 2026-01-12 | 初始发布 |

---

## 授权

此技能以 [CC BY 4.0](https://creativecommons.org/licenses/by/4.0/) 授权发布。

**来源**：[universal-dev-standards](https://github.com/AsiaOstrich/universal-dev-standards)
